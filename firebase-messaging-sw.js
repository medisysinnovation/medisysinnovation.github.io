importScripts("https://www.gstatic.com/firebasejs/8.5.0/firebase-app.js"),importScripts("https://www.gstatic.com/firebasejs/8.5.0/firebase-messaging.js");let config={subscribeFCM:!0,sessionClosed:!0},defaultNotificationTemplate={default:{title:"You got a new message"},action:{title:"default action title",options:{actions:[{action:"action-1",title:"Action 1",icon:"/images/demos/action-1-128x128.png"},{action:"action-2",title:"Action 2",icon:"/images/demos/action-2-128x128.png"}],body:"Test body message"}}};self.addEventListener("notificationclick",(t=>{t.notification.close(),t.waitUntil(clients.matchAll({includeUncontrolled:!0,type:"window"}).then((e=>{const i=e.some((e=>(!t.notification.data||e.url===t.notification.data.url)&&(e.focus(),!0)));i||clients.openWindow(t.notification.data?.url||config.sitePath).then((t=>t?t.focus():null))})))}));const messageHandler=async t=>{console.log("[firebase-messaging-sw.js] Received background message ",t);const{data:e}=t,i=e?.data?JSON.parse(e.data):e,{notificationType:a,notification:o}=i||{},s=await self.clients.matchAll({includeUncontrolled:!0});s.forEach((t=>{t.postMessage({firebaseMessaging:{type:"background-push-received",payload:{...e,data:i}}})}));const n=defaultNotificationTemplate[a];n?registration.showNotification(e.title||n.title,n.options):o&&registration.showNotification(e.title||o.title,o.options)};self.addEventListener("message",(t=>{const{data:e}=t,{type:i,data:a}=e;switch(console.log(i,a),i){case"init":firebase.apps.length||firebase.initializeApp(a);const t=firebase.messaging();t.onBackgroundMessage(messageHandler);break;case"updateFCMConfig":config={...config,...a};break;case"updateNotificationTemplate":defaultNotificationTemplate={...defaultNotificationTemplate,...a};break;default:break}}));