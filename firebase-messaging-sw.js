importScripts("https://www.gstatic.com/firebasejs/8.5.0/firebase-app.js"),importScripts("https://www.gstatic.com/firebasejs/8.5.0/firebase-messaging.js");const omitUndefined=(t,{allowEmpty:e=!1,autoTrim:i=!0}={})=>{const a={};return Object.keys(t||{}).forEach((e=>{void 0!==t[e]&&null!==t[e]&&("string"===typeof t[e]&&i?a[e]=t[e].trim():a[e]=t[e])})),Object.keys(a).length<1?e?t:void 0:a};let config={subscribeFCM:!0,sessionClosed:!0},defaultNotificationTemplate={default:{title:"You got a new message"},action:{title:"default action title",options:{actions:[{action:"action-1",title:"Action 1",icon:"/images/demos/action-1-128x128.png"},{action:"action-2",title:"Action 2",icon:"/images/demos/action-2-128x128.png"}],body:"Test body message"}}};self.addEventListener("notificationclick",(t=>{t.notification.close(),t.waitUntil(clients.matchAll({includeUncontrolled:!0,type:"window"}).then((e=>{console.log(t.notification);const i=e.some((e=>(!t.notification.data||e.url===t.notification.data.url)&&(e.focus(),!0)));i||clients.openWindow(t.notification.data?.url||config.sitePath).then((t=>t?t.focus():null))})))}));const messageHandler=async t=>{console.log("[firebase-messaging-sw.js] Received background message ",t);const{data:e}=t,i=e?.data?JSON.parse(e.data):e,{notificationType:a,notification:o}=i||{},n=await self.clients.matchAll({includeUncontrolled:!0});n.forEach((t=>{t.postMessage({firebaseMessaging:{type:"background-push-received",payload:{...e,data:i}}})}));const s=defaultNotificationTemplate[a];s?registration.showNotification(e.title||s.title,s.options):o&&registration.showNotification(o.title||e.title,omitUndefined(o))};self.addEventListener("message",(t=>{const{data:e}=t,{type:i,data:a}=e;switch(i){case"init":firebase.apps.length||firebase.initializeApp(a);const t=firebase.messaging();t.onBackgroundMessage(messageHandler);break;case"updateFCMConfig":config={...config,...a};break;case"updateNotificationTemplate":defaultNotificationTemplate={...defaultNotificationTemplate,...a};break;default:break}}));