importScripts("http://www.gstatic.com/firebasejs/8.5.0/firebase-app.js"),importScripts("http://www.gstatic.com/firebasejs/8.5.0/firebase-messaging.js");let config={subscribeFCM:!0,sessionClosed:!0},notificationConfig={default:{title:"You got a new message from Banchoon WMS"},action:{title:"default action title",options:{actions:[{action:"action-1",title:"Action 1",icon:"/images/demos/action-1-128x128.png"},{action:"action-2",title:"Action 2",icon:"/images/demos/action-2-128x128.png"}],body:"Test body message"}}};const getMobileMessage=t=>{switch(t){case"REQUEST_VIDEO_CONSULT":return"Incoming Tele-Consultation";default:return""}};self.addEventListener("notificationclick",(t=>{console.log(t),t.notification.close(),t.waitUntil(clients.matchAll({includeUncontrolled:!0,type:"window"}).then((e=>{const i=e.some((e=>(!t.notification.data||e.url===t.notification.data.url)&&(e.focus(),!0)));i||clients.openWindow(t.notification.data?.url||config.sitePath).then((t=>t?t.focus():null))})))}));const messageHandler=async t=>{console.log("[firebase-messaging-sw.js] Received background message ",t);const{data:e,priority:i}=t,o=e?.data?JSON.parse(e.data):e,{system:{sender:n,redirect:s}={},topic:a,message:c,notificationType:l,notification:g}=o||{},f=(c||getMobileMessage(a),await self.clients.matchAll({includeUncontrolled:!0}));f.forEach((e=>{e.postMessage({firebaseMessaging:{type:"backgroud-push-received",payload:t}})}));const r=notificationConfig[l];if(r)registration.showNotification(r.title,r.options);else if(g){const t=JSON.parse(g);registration.showNotification(t.title,t.options)}};self.addEventListener("push",(function(t){t.data?console.log("This push event has data: ",t.data.text()):console.log("This push event has no data.")})),self.addEventListener("message",(t=>{const{data:e}=t,{type:i,data:o}=e;switch(console.log(i,o),i){case"init":firebase.initializeApp(o);const t=firebase.messaging();t.onBackgroundMessage(messageHandler);break;case"update_fcm_config":config={...config,...o};break;case"update_notification_config":notificationConfig={...notificationConfig,...o};break;default:break}}));